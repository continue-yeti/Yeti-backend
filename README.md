# [Yeti] ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì—ì„œë„ ì›í™œí•œ í‹°ì¼€íŒ…ì´ ê°€ëŠ¥í•œ ì˜ˆë§¤ í”Œë«í¼

---

![image](https://github.com/Yeti-spring-project/Yeti/assets/76715487/5174be80-f960-491b-84a4-750d2ff94ea9)


# ğŸ« 01. í”„ë¡œì íŠ¸ ì†Œê°œ

## 1ï¸âƒ£ ì„œë¹„ìŠ¤ ê°œìš”  

> YetiëŠ” ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì—ì„œë„ ì›í™œí•œ í‹°ì¼€íŒ…ì´ ê°€ëŠ¥í•œ ì˜ˆë§¤ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
> 

 ì˜¨ë¼ì¸ ì„œë¹„ìŠ¤ì˜ ìˆ˜ìš”ê°€ ëŠ˜ì–´ê°ì— ë”°ë¼, ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì˜ í•„ìš”ì„±ì´ ëŠ˜ì–´ë‚˜ê³  ìˆìŠµë‹ˆë‹¤. ì €í¬ ì¡°ëŠ” ì´ëŸ¬í•œ íë¦„ì— ë§ì¶° ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì—ì„œë„ ê³ ê°€ìš©ì„±ì„ í™•ë³´í•˜ê³ , ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ ë¹ ë¥¸ ì²˜ë¦¬ì†ë„ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œì„ ë§Œë“¤ì–´ë³´ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. ì´ì—, í‹°ì¼“ ì˜ˆë§¤ ì„œë¹„ìŠ¤ê°€ í•´ë‹¹ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê¸°ì— ì í•©í•œ ì£¼ì œë¼ ìƒê°ë˜ì–´ ì˜ˆë§¤ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

[Yeti-spring-project](https://github.com/Yeti-spring-project)
[Yeti-Notion](https://cheerful-beast-329.notion.site/Yes-Ticket-yeti-2d228454ae42461ba6023e71a3036c43)

## 2ï¸âƒ£ í”„ë¡œì íŠ¸ ëª©í‘œ

![image](https://github.com/Yeti-spring-project/Yeti/assets/76715487/14374ebe-6e62-4104-80b9-75752650daf7)


- ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì— ëŒ€í•œ ê³ ê°€ìš©ì„± í™•ë³´
- ë™ì‹œì„± ì œì–´ ë° ìµœì í™”
- í™•ì¥ì„± ê°•í™” ë° ëª¨ë“ˆí™”

## 3ï¸âƒ£ ì£¼ìš” ê¸°ëŠ¥

- ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ìƒí™©ì—ì„œë„ ì›í™œí•œ í‹°ì¼€íŒ…ì´ ê°€ëŠ¥
- ê²€ìƒ‰ ì„œë²„ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì•ˆì •ì ì¸ ê²½ê¸° ê²€ìƒ‰ ì œê³µ
- ì‚¬ìš©ìê°€ ê°‘ì‘ìŠ¤ëŸ½ê²Œ ë§ì•„ì§ˆ ê²½ìš° ëŒ€ê¸°ì—´ë¡œ íŠ¸ë˜í”½ ì¡°ì ˆ

---

# ğŸ« 02. ê¸°ìˆ  ìŠ¤íƒ

| Frontend                                                                                                  | Backend                                                                                                                                                                                                                                              | Database                                                                                                                                                                                                                              | DevOps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Others                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|-----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <img src="https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=React&logoColor=white"><br/> | <img src="https://img.shields.io/badge/Spring Boot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white"/><br/> <img src="https://img.shields.io/badge/Spring Security-6DB33F?style=for-the-badge&logo=springsecurity&logoColor=white"/> <br/> | <img src="https://img.shields.io/badge/redis-DC382D?style=for-the-badge&logo=redis&logoColor=white"><br/>  <img src="https://img.shields.io/badge/postgreSQL-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white"><br/> | <img src="https://img.shields.io/badge/amazon%20ec2-FF9900?style=for-the-badge&logo=amazon%20ec2&logoColor=white"><br/> <img src="https://img.shields.io/badge/amazon%20rds-527FFF?style=for-the-badge&logo=amazon%20rds&logoColor=white"><br/> <img src="https://img.shields.io/badge/amazon%20s3-569A31?style=for-the-badge&logo=amazons3&logoColor=white"><br/> <img src="https://img.shields.io/badge/amazon%20alb-FF9900?style=for-the-badge"/><br/> <img src="https://img.shields.io/badge/amazon%20codedeploy-569A31?style=for-the-badge"/><br/>  <img src="https://img.shields.io/badge/docker-2496ED?style=for-the-badge&logo=docker&logoColor=white"><br/> <img src="https://img.shields.io/badge/github%20actions-2088FF?style=for-the-badge&logo=github%20actions&logoColor=white"><br/> <img src="https://img.shields.io/badge/vercel-%23000000?style=for-the-badge&logo=vercel&logoColor=white"> | <img src="https://img.shields.io/badge/elasticsearch-4053D6?style=for-the-badge&logo=elasticsearch&logoColor=white"><br/> <img src="https://img.shields.io/badge/logstash-FCC624?style=for-the-badge&logo=logstash&logoColor=white"><br/> <img src="https://img.shields.io/badge/kibana-00bfb3?style=for-the-badge&logo=kibana"/><br/> <img src="https://img.shields.io/badge/pinpoint-007ACC?style=for-the-badge"/><br/> <img src="https://img.shields.io/badge/jmeter-FF4500?style=for-the-badge"/><br/> |


---

# ğŸ« 03. ê¸°ìˆ ì  ì˜ì‚¬ ê²°ì •


| ìš”êµ¬ì‚¬í•­ | ì„ íƒì§€ | ê¸°ìˆ  ì„ íƒ ì´ìœ  |
| --- | --- | --- |
| CI/CD | Jenkins<br/> Github Action<br/> | Github Action<br/> í´ë¼ìš°ë“œì—ì„œ ë™ì‘í•˜ë¯€ë¡œ ë‹¤ë¥¸ ì„œë²„ë¥¼ ì„¤ì¹˜ í•˜ì§€ ì•Šì•„ë„ ë˜ê¸° ë•Œë¬¸ì— ê°€ê²©ì  ì¸¡ë©´ê³¼ ìì› ì†Œëª¨ë¥¼ ì¤„ì¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë˜í•œ GitHubì— push, PR ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ìë™ ë°°í¬ê°€ ê°€ëŠ¥í•˜ì—¬ ê°œë°œì— ëª°ë‘ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Blue/Green ì „ëµì„ ì´ìš©í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ë¡œ ì„œë¹„ìŠ¤ë¥¼ ëŠê¹€ì—†ì´ ê³„ì† ì´ìš© ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. |
| ëª¨ë‹ˆí„°ë§ | Elastic APM <br/>Prometheus <br/>Grafana <br/>PinPoint âœ”ï¸ | Pinpoint<br/> ì „ì²´ì ì¸ íŠ¸ëœì­ì…˜ì˜ íë¦„ì„ ì‰½ê²Œ íŒŒì•…ì´ ê°€ëŠ¥í•˜ê³ , ì‚¬ìš©ìê°€ ì§ì ‘ ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ì§€ ì•Šì•„ë„ ë˜ë©´ì„œ ê·¸ë˜í”„ê°€ ë§¤ìš° ì•Œê¸° ì‰½ê²Œ í‘œí˜„ë©ë‹ˆë‹¤. ëŒ€ê·œëª¨ ì‹œìŠ¤í…œì˜ ë¶„ì‚° íŠ¸ëœì­ì…˜ ì¶”ì  ë° ì‹œê°í™”ê°€ ìš©ì´í•´ ëª¨ë‹ˆí„°ë§ APMì„ Pinpointë¡œ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤ |
| ê²€ìƒ‰ ì„±ëŠ¥ ê°œì„  | MongoDB<br/>Elasticsearchâœ”ï¸ | Elasticsearch <br/> RDBMSì—ì„œë„ í…ìŠ¤íŠ¸ ê²€ìƒ‰ì„ ìœ„í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ë§Œ, ì™€ì¼ë“œì¹´ë“œë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ë³µì¡í•œ íŒ¨í„´ì„ ì‚¬ìš©í•œ ê²€ìƒ‰ì— ìˆì–´ì„œ ì„±ëŠ¥ì €í•˜ê°€ ìš°ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê²€ìƒ‰ ì„±ëŠ¥ ê°œì„ ì„ ìœ„í•´ NoSQL DBì¸ MongoDBì™€ Elasticsearchë¥¼ ê³ ë ¤í–ˆê³ , ìµœì¢…ì ìœ¼ë¡œ Elasticsearchë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  Elasticsearchë¥¼ ì„ íƒí•œ ì´ìœ ë¡œëŠ” Elasticsearchê°€ ì œê³µí•˜ëŠ” ê°•ë ¥í•œ í’€ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê¸°ëŠ¥ê³¼ QueryDSLì´ í”„ë¡œì íŠ¸ì— ì¢€ ë” ì í•©í•˜ë‹¤ê³  ìƒê°í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë˜í•œ ì´í›„ í™•ì¥ì„±ì„ ê³ ë ¤í•´ë³´ì•˜ì„ ë•Œì—ë„ ë¶„ì‚°í˜• ì‹œìŠ¤í…œìœ¼ë¡œ ì„¤ê³„ëœ Elasticsearchë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìœ ë¦¬í•˜ë‹¤ê³  ìƒê°ë˜ì—ˆìŠµë‹ˆë‹¤. |
| ë°ì´í„°ë² ì´ìŠ¤ | MySQL <br/> PostgreSQL âœ”ï¸ <br/> MongDB | PostgreSQL <br/> ë™ì‹œì„± ì œì–´ ì„±ëŠ¥ì´ MySQLì— ë¹„í•´ ë›°ì–´ë‚˜ë©° ë‹¤ì¤‘ ë²„ì „ ë™ì‹œì„± ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë˜í•œ ì“°ê¸° ë° ì¡°íšŒ ì„±ëŠ¥ì´ ë‹¤ë¥¸ RDBì— ë¹„í•´ ìš°ìˆ˜í•˜ë‹¤ê³  ì•Œë ¤ì ¸ ìˆê¸° ë•Œë¬¸ì— ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬ì— ìš©ì´í•˜ë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤. |
| ë°ì´í„° íŒŒì´í”„ ë¼ì¸ | Kafka <br/> Redis âœ”ï¸ | Redis <br/> ì„±ëŠ¥ì´ ë›°ì–´ë‚˜ê³  ê°„ë‹¨í•œ ë°ì´í„° ëª¨ë¸ì„ ì§€ì›í•´ ì‚¬ìš©ì´ ìš©ì´í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì˜ì†ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³´ì¡´ ê°€ëŠ¥í•˜ë©° ë¦¬ìŠ¤íŠ¸í˜• ë°ì´í„° ì…ë ¥ê³¼ ì‚­ì œê°€ ë°ì´í„°ë² ì´ìŠ¤ë³´ë‹¤ ë§¤ìš° ë¹ ë¥´ë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤. Kafkaë„ í›„ë³´ì— ìˆì—ˆì§€ë§Œ, í”„ë¡œì íŠ¸ì˜ ê·œëª¨ë‚˜ ê¸°ê°„ì„ ê³ ë ¤í•  ë•Œ ì¶”ê°€ì ì¸ í•™ìŠµì´ í•„ìš”í•œ Kafkaë¥¼ ë„ì…í•˜ê¸°ë³´ë‹¤ëŠ” ê¸°ì¡´ì— ì‚¬ìš©í•´ë³´ì•˜ë˜ Redisë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. |
| ë¶€í•˜í…ŒìŠ¤íŠ¸ | JMeter âœ”ï¸ <br/> nGrinder | JMeter <br/>ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸í•˜ê¸° ìš©ì´í•˜ê³ , GUI ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ì‰½ìš°ë©° í”ŒëŸ¬ê·¸ì¸ ì§€ì›ì´ í’ë¶€í•©ë‹ˆë‹¤. ê²°ì •ì ìœ¼ë¡œ, nGrinderê°€ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” Java 17 ë²„ì „ì„ ì§€ì›í•˜ì§€ ì•Šì•„ì„œ JMeterë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤. |

# ğŸ« 04. ì•„í‚¤í…ì³

## ì•„í‚¤í…ì³ êµ¬ì„±ë„

![image](https://github.com/Yeti-spring-project/Yeti/assets/76715487/d4a8c4e1-86c1-4557-a992-93775b193b6b)


## ERD

![image](https://github.com/Yeti-spring-project/Yeti/assets/76715487/b10c122b-d15c-475b-9625-4b7035b4b305)


---

# ğŸ« 05. íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### ë™ì‹œì„± ì œì–´ ë¯¸ì ìš©ì‹œì— DeadLockì´ ë°œìƒí•˜ëŠ” ë¬¸ì œ 

- í‹°ì¼“ 22ê°œê°€ ì˜ˆë§¤ ë˜ë‹¤ê°€ ì´í›„ì— ë°ë“œë½ì´ ê±¸ë ¸ìŠµë‹ˆë‹¤. ( 89 â†’ 67 )

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/76069a67-bbe8-437e-b3bc-6afc7dcff7d5/8e1bb664-2a91-4896-928f-18833bc0a985/Untitled.png)

- Spring ì—ëŸ¬ ë¡œê·¸
    
    ```java
    2023-12-10T18:11:44.182+09:00 ERROR 36492 --- [nio-8080-exec-4] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.dao.CannotAcquireLockException: could not execute statement [Deadlock found when trying to get lock; try restarting transaction] [/* update for com.example.yetiproject.entity.TicketInfo */update ticket_info set close_date=?,open_date=?,sports_id=?,stock=?,ticket_price=? where ticket_info_id=?]; SQL [/* update for com.example.yetiproject.entity.TicketInfo */update ticket_info set close_date=?,open_date=?,sports_id=?,stock=?,ticket_price=? where ticket_info_id=?]] with root cause
    
    com.mysql.cj.jdbc.exceptions.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction
    	at com.mysql.cj.jdbc.exceptions.SQLError.createSQLException(SQLError.java:124) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:122) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1061) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1009) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.mysql.cj.jdbc.ClientPreparedStatement.executeLargeUpdate(ClientPreparedStatement.java:1320) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdate(ClientPreparedStatement.java:994) ~[mysql-connector-j-8.1.0.jar:8.1.0]
    	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61) ~[HikariCP-5.0.1.jar:na]
    	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java) ~[HikariCP-5.0.1.jar:na]
    	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:280) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.jdbc.mutation.internal.AbstractMutationExecutor.performNonBatchedMutation(AbstractMutationExecutor.java:107) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorSingleNonBatched.performNonBatchedOperations(MutationExecutorSingleNonBatched.java:40) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.jdbc.mutation.internal.AbstractMutationExecutor.execute(AbstractMutationExecutor.java:52) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.doStaticUpdate(UpdateCoordinatorStandard.java:769) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.performUpdate(UpdateCoordinatorStandard.java:325) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.coordinateUpdate(UpdateCoordinatorStandard.java:242) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.persister.entity.AbstractEntityPersister.update(AbstractEntityPersister.java:2802) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.action.internal.EntityUpdateAction.execute(EntityUpdateAction.java:166) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:631) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:498) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.event.internal.AbstractFlushingEventListener.performExecutions(AbstractFlushingEventListener.java:363) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.event.internal.DefaultFlushEventListener.onFlush(DefaultFlushEventListener.java:39) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.internal.SessionImpl.doFlush(SessionImpl.java:1415) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.internal.SessionImpl.managedFlush(SessionImpl.java:496) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.internal.SessionImpl.flushBeforeTransactionCompletion(SessionImpl.java:2325) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.internal.SessionImpl.beforeTransactionCompletion(SessionImpl.java:1988) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.beforeTransactionCompletion(JdbcCoordinatorImpl.java:439) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.beforeCompletionCallback(JdbcResourceLocalTransactionCoordinatorImpl.java:169) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:267) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:101) ~[hibernate-core-6.3.1.Final.jar:6.3.1.Final]
    	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:561) ~[spring-orm-6.1.1.jar:6.1.1]
    	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:794) ~[spring-tx-6.1.1.jar:6.1.1]
    	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:757) ~[spring-tx-6.1.1.jar:6.1.1]
    	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:669) ~[spring-tx-6.1.1.jar:6.1.1]
    	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:419) ~[spring-tx-6.1.1.jar:6.1.1]
    	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119) ~[spring-tx-6.1.1.jar:6.1.1]
    	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.1.1.jar:6.1.1]
    	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765) ~[spring-aop-6.1.1.jar:6.1.1]
    	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717) ~[spring-aop-6.1.1.jar:6.1.1]
    	at com.example.yetiproject.service.TicketService$$SpringCGLIB$$0.reserveTicket(<generated>) ~[main/:na]
    	at com.example.yetiproject.controller.TicketController.reserveTicket(TicketController.java:50) ~[main/:na]
    	at jdk.internal.reflect.GeneratedMethodAccessor64.invoke(Unknown Source) ~[na:na]
    	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
    	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
    	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.16.jar:6.0]
    	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.1.1.jar:6.1.1]
    	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.16.jar:6.0]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter.doFilterInternal(DefaultLogoutPageGeneratingFilter.java:58) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter.doFilter(DefaultLoginPageGeneratingFilter.java:189) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter.doFilter(DefaultLoginPageGeneratingFilter.java:175) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at com.example.yetiproject.auth.jwt.JwtAuthorizationFilter.doFilterInternal(JwtAuthorizationFilter.java:55) ~[main/:na]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.2.0.jar:6.2.0]
    	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]
    ```
    

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/76069a67-bbe8-437e-b3bc-6afc7dcff7d5/5e85a925-1b82-4e59-8f47-55b4480fa958/Untitled.png)

<aside>
ğŸ’¡ P1ê³¼ P2ê°€ ë¦¬ì†ŒìŠ¤ A, B ë‘˜ ë‹¤ë¥¼ ì–»ì–´ì•¼ í•œë‹¤ê³  ê°€ì •í•  ë•Œ,t1ì— P1ì´ ë¦¬ì†Œë¥¼ Aë¥¼ ì–»ê³  P2ê°€ ë¦¬ì†ŒìŠ¤ Bë¥¼ ì–»ì—ˆë‹¤ë©´ t2ë•Œ P1ì€ ë¦¬ì†ŒìŠ¤ Bë¥¼, P2ëŠ” ë¦¬ì†ŒìŠ¤ Aë¥¼ ê¸°ë‹¤ë¦¬ê²Œ ë©ë‹ˆë‹¤.í•˜ì§€ë§Œ ì„œë¡œ ì›í•˜ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ìƒëŒ€ë°©ì—ê²Œ í• ë‹¹ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì´ ë‘ í”„ë¡œì„¸ìŠ¤ëŠ” ë¬´í•œì • ê¸°ë‹¤ë¦¬ê²Œ ë˜ëŠ”ë° ì´ëŸ¬í•œ ìƒíƒœì„ DeadLockìƒíƒœë¼ê³  í•©ë‹ˆë‹¤.

</aside>

- í•´ê²°
    - Redissonìœ¼ë¡œ ë¶„ì‚°ë½ì„ ì ìš©ì‹œì¼œ ë™ì‹œì„± ì œì–´ë¥¼ ì ìš©ì‹œí‚¤ë‹ˆ DeadLock í˜„ìƒì´ ì‚¬ë¼ì¡Œë‹¤.

### ë™ì‹œì„± ì œì–´ ì ìš© í›„ Requestê°€ ì¼ë¶€ ì‹¤íŒ¨í•˜ëŠ” ë¬¸ì œ

> ì²˜ìŒ ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ê³ ë¯¼í–ˆë˜ ë¬¸ì œëŠ” â€˜ë™ì‹œì„± ì œì–´â€™ ì´ìŠˆì˜€ë‹¤.
í”„ë¡ íŠ¸ì— ìµìˆ™í•˜ì§€ ì•Šì•˜ë˜ ìš°ë¦¬ëŠ” íšŒì›ê°€ì…-ë¡œê·¸ì¸-í‹°ì¼“ëª©ë¡í˜ì´ì§€ì—ì„œ 
ë°”ë¡œ ì˜ˆë§¤ë¥¼ í•˜ë„ë¡ í˜ì´ì§€ë¥¼ êµ¬ì„±í–ˆë‹¤. ê·¸ ì´í›„ ë°°í¬ í›„ 10ë§Œê±´ì˜ ë°ì´í„°ë¥¼ Jmeterë¥¼ ì „ì†¡í•˜ì—¬ í…ŒìŠ¤íŠ¸í•´ë³´ë‹ˆ 2ë§Œê±´ë§Œ requestì— ì„±ê³µí–ˆë‹¤.
ì´í›„ ì½”ë“œë¥¼ ì‚´í´ë³´ë‹ˆ ë½ì„ ê²½ê¸°ê´€ëŒ(ticketInfoId)ì— ê±¸ê³  ìˆì—ˆë‹¤.
> 

```java
public TicketResponseDto reserveTicket(UserDetailsImpl userDetails, TicketRequestDto requestDto) {
        Long ticketInfoId = requestDto.getTicketInfoId();
        RLock lock = redissonClient.getLock(ticketInfoId.toString());
        TicketResponseDto responseDto;

... (ìƒëµ)
}
```

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/76069a67-bbe8-437e-b3bc-6afc7dcff7d5/53c9aa3e-0271-4bfb-9f41-881b5a36bbe6/Untitled.png)

- í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì 
    - ì¢Œì„ì„ ì˜ˆë§¤í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì¢Œì„ì´ ê°™ì€ ì‚¬ëŒë“¤ì— ëŒ€í•´ ë½ì´ ê±¸ë ¤ì•¼ í•œë‹¤.
    - í•„ìš”ì—†ëŠ” í•œ ì‚¬ëŒê¹Œì§€ë„ ë½ì´ ê±¸ë¦¬ëŠ” ê²ƒì´ë‹¤. ë§Œì•½ 100ëª… í•œ ê²½ê¸°ê´€ëŒì„ ì˜ˆë§¤í•˜ê¸° ìœ„í•´ â€˜ì˜ˆë§¤í•˜ê¸°â€™ë¥¼ ëˆ„ë¥´ìë§ˆì ë½ì„ íšë“í•˜ê¸° ìœ„í•´ ì‹œë„í•œë‹¤. ì½”ë“œì˜ ê°œì„ ì´ í•„ìš”í–ˆë‹¤.
    
    ## Seat Entity ì¶”ê°€
    
    ```java
    public class Seat {
    	private Long posX;
    	private Long posY;
    
    	public Seat(Long posX, Long posY) {
    		this.posX = posX;
    		this.posY = posY;
    	}
    }
    ```
    

```java
public void reserveTicket(User user, TicketRequestDto ticketRequestDto){
		Seat seat = new Seat(ticketRequestDto.getPosX(), ticketRequestDto.getPosY());
		RLock lock = redissonClient.getLock("ticket seat- " + seat);

...(ìƒëµ)

}
```

## Redisì˜ Redissonì„ ì„ íƒí•œ ì´ìœ 

- ìë°” ìŠ¤í”„ë§ ê¸°ë°˜ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ êµ¬ë™ì´ ëœë‹¤.
- ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê³µìœ  ìì›ì— ëŒ€í•œ Race conditionì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë³„ë„ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
- synchronizedë¼ëŠ” ìƒí˜¸ë°°ì œ ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ë§Œ ê°™ì€ í”„ë¡œì„¸ìŠ¤ì—ì„œë§Œ ìƒí˜¸ ë°°ì œë¥¼ ë³´ì¥í•œë‹¤.
- ë‹¨ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ë¼ë©´ ìƒê´€ì—†ì§€ë§Œ ë‚˜ì¤‘ì— ì„œë²„ë¥¼ ë‹¤ì¤‘í™”í•œë‹¤ë©´ ë‹¤ì‹œ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.
- Lettue LockëŠ” setnx ë©”ì„œë“œë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ì§ì ‘ ìŠ¤í•€ë½ í˜•íƒœë¡œ êµ¬ì„±í•œë‹¤. ë½ ì ìœ ì— ì‹¤íŒ¨í•˜ë©´ ê³„ì† ì ìœ  ì‹œë„ë¥¼ í•˜ê¸°ë•Œë¬¸ì— ë ˆë””ìŠ¤ì˜ ë¶€í•˜ë¥¼ ì¼ìœ¼í‚¤ê²Œ ëœë‹¤.
- Lettuceì˜ ê²½ìš° ë§Œë£Œì‹œê°„ì„ ì œê³µí•˜ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì—, Redissionê³¼ëŠ” ë‹¤ë¥´ê²Œ ë§Œì•½ Lockì„ ì¡ê³  ìˆëŠ” ìƒíƒœì—ì„œ ì¥ì• ê°€ ë°œìƒí•œë‹¤ë©´ ë‹¤ë¥¸ ì„œë²„ë“¤ì—ì„œ ë½ì„ ì ìœ  í•  ìˆ˜ ì—†ë‹¤.

---

> ë™ì‹œì„± ë¬¸ì œëŠ” í•´ê²°ë˜ì—ˆì§€ë§Œ ì—¬ì „íˆ íŠ¸ë˜í”½ì´ ê°‘ìê¸° 70ë§Œê±´ 50ë§Œê±´ ëª°ë¦¬ê²Œ ë˜ëŠ” ë¬¸ì œì— ëŒ€í•´ì„œ ê³ ë ¤ë¥¼ í•´ì•¼ í–ˆë‹¤. ê·¸ë˜ì„œ ì„ íƒí•˜ê²Œ ëœ ê²ƒì€ Redisë¡œ ëŒ€ê¸°ì—´ì„ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì´ë‹¤.
> 

### Lock íšë“ ì‹œë„ ì‹¤íŒ¨ ë° Lock ë°˜í™˜ ë¬¸ì œ

- Lock íšë“ì´ ì‹¤íŒ¨í•˜ë©´ì„œ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤.
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/76069a67-bbe8-437e-b3bc-6afc7dcff7d5/8ed43459-9168-445d-99ce-83a7a3449bcb/Untitled.png)
    
- ì‹œë„
    1. ìœ„ ì—ëŸ¬ëŠ” Lockì„ íšë“í•˜ì§€ ëª»í•œ ìŠ¤ë ˆë“œê°€ Lockì„ í•´ì œí•˜ë ¤ê³  ì‹œë„í•  ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¡œ, ì•„ë˜ ì½”ë“œì˜ try~catch~finally êµ¬ë¬¸ ì¤‘ finally ë¶€ë¶„ì—ì„œ í˜„ì¬ ìŠ¤ë ˆë“œê°€ Lockì„ íšë“í–ˆëŠ”ì§€ë¥¼ ê²€ì¦í•˜ëŠ” `isHeldByCurrentThread()` ë©”ì„œë“œë¥¼ ì¡°ê±´ë¬¸ì— ì¶”ê°€í•´ í•´ê²°í•˜ì˜€ë‹¤.
        
        ```java
        @Component
        @Slf4j(topic = "ì˜ˆë§¤í•˜ê¸°")
        @RequiredArgsConstructor
        public class RedissonLockTicketFacade {
        
            private final RedissonClient redissonClient;
            private final TicketService ticketService;
        
            // ì˜ˆë§¤í•˜ê¸° ë¶€ë¶„ì— Redissonìœ¼ë¡œ ë½ì„ ê±¸ì–´ì¤Œ
            public TicketResponseDto reserveTicket(UserDetailsImpl userDetails, TicketRequestDto requestDto) {
                Long ticketInfoId = requestDto.getTicketInfoId();
                RLock lock = redissonClient.getLock(ticketInfoId.toString());
                TicketResponseDto responseDto;
        
                try {
                    // lock íšë“ ì‹œë„ ì‹œê°„, lock ì ìœ  ì‹œê°„
                    boolean available = lock.tryLock(10, 1, TimeUnit.SECONDS);
        
                    if (!available) {
                        log.info("lock íšë“ ì‹¤íŒ¨");
                        return new TicketResponseDto();
                    }
                    responseDto = ticketService.reserveTicket(userDetails.getUser(), requestDto);
        
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                } finally {
                    if (lock.isHeldByCurrentThread()) { // ì¶”ê°€
                        lock.unlock();
                    }
                }
        
                return responseDto;
            }
        }
        ```
        
    2. í•´ë‹¹ ë©”ì„œë“œë¥¼ ì ìš©ì‹œí‚¤ë‹ˆ IllegalMonitorStateExceptionì€ ë” ì´ìƒ ë°œìƒí•˜ì§€ ì•Šì•˜ì§€ë§Œ, ì—¬ì „íˆ Lock íšë“ì— ì‹¤íŒ¨í•˜ëŠ” ìŠ¤ë ˆë“œê°€ ë°œìƒí•˜ì˜€ë‹¤. ëŒ€ëŸ‰ì˜ ìš”ì²­ì´ ë™ì‹œì— ë“¤ì–´ì˜¤ëŠ” ê³¼ì •ì—ì„œ Lockì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ì´ ê¸°ì¡´ì— ì„¤ì •ê°’ì´ì—ˆë˜ 10ì´ˆ ì´ìƒìœ¼ë¡œ ê¸¸ì–´ì ¸ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë¼ê³  íŒë‹¨í•˜ì—¬ Lock íšë“ì„ ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ì‹œê°„ì„ 30ì´ˆë¡œ ì—°ì¥ì‹œì¼°ë‹¤. ì´ í›„ Lock íšë“ê³¼ ê´€ë ¨ëœ ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•Šì•˜ì§€ë§Œ, ì„œë²„ì—ì„œ ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì€ ê³„ì†ì—ˆë‹¤.
    3. Redissonìœ¼ë¡œ ë¶„ì‚°ë½ì„ ì ìš©ì‹œí‚¤ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì‚¬ìš©í•´ ì„œë²„ì— ì¥ì• ë¥¼ ì¼ìœ¼í‚¤ëŠ” ê²ƒì´ë¼ íŒë‹¨í•˜ì—¬ ë¶„ì‚°ë½ì„ ì ìš©ì‹œí‚¤ëŠ” ë¡œì§ì„ ì œê±°í•˜ê³ , ë™ì‹œì„± ì œì–´ë¥¼ ìœ„í•´ Redisì˜ Listë‚˜ Sorted setì„ ì´ìš©í•œ Queue ì‹œìŠ¤í…œì„ ë„ì…í•˜ê¸°ë¡œ í•˜ì˜€ë‹¤.

### HBASE & JDK17 ë²„ì „ ì´ìŠˆ

- ë³¸ í”„ë¡œì íŠ¸ì—ì„œ JDK17 ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆì–´ ëª¨ë‹ˆí„°ë§ ì„œë²„ì—ë„ ìì—°ìŠ¤ëŸ½ê²Œ JDK17 ë²„ì „ì„ ì„¤ì¹˜í–ˆë‹¤. HBASEë„ ì„¤ì¹˜í•œ ë’¤ ì‹¤í–‰ì‹œì¼°ëŠ”ë° ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë…¸ì¶œëë‹¤.

```docker
Unrecognized VM option 'UseConcMarkSweepGC'
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
Unrecognized VM option 'UseConcMarkSweepGC'
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
running master, logging to /hbase-2.2.0/bin/../logs/hbase-root-master-localhost.out
Unrecognized VM option 'UseConcMarkSweepGC'
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
: running regionserver, logging to /hbase-2.2.0/bin/../logs/hbase-root-regionserver-localhost.out
: Unrecognized VM option 'UseConcMarkSweepGC'
: Error: Could not create the Java Virtual Machine.
: Error: A fatal exception has occurred. Program will exit.
```

- í•´ê²°
    - CMS garbage collectorê°€ JDK 15ì—ì„œ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ UseConcMarkSweepGCë„ ì œê±°ë˜ì–´ì„œ ë°œìƒí•œ ì—ëŸ¬ë¼ê³  í•œë‹¤. JDK11ë¡œ ë²„ì „ì„ ë‚´ë ¤ì„œ ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ì˜€ë‹¤.

### HBASE & JDK11 ê´€ë ¨ í…Œì´ë¸” ìƒì„± ì´ìŠˆ

- HBASE í™œì„±í™” ì´í›„ ë°ì´í„°ë¥¼ ë‹´ì„ í…Œì´ë¸”ì´ í•„ìš”í•´ pinpointì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°›ì•„ ì ìš©í•˜ë ¤ ì‹œë„í–ˆë”ë‹ˆ, hbase shell ì‹¤í–‰ ë‹¨ê³„ì—ì„œ ArgumentError: wrong number of arguments (0 for 1) ë¼ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

```docker
$ bin/hbase  shell
Java HotSpot(TM) 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.jruby.java.invokers.RubyToJavaInvoker (file:/Users/user/Hbase/Hb126/lib/jruby-complete-1.6.8.jar) to method java.lang.Object.registerNatives()
WARNING: Please consider reporting this to the maintainers of org.jruby.java.invokers.RubyToJavaInvoker
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release
ArgumentError: wrong number of arguments (0 for 1)
  method_added at file:/Users/user/Hbase/Hb126/lib/jruby-complete-1.6.8.jar!/builtin/javasupport/core_ext/object.rb:10
  method_added at file:/Users/user/Hbase/Hb126/lib/jruby-complete-1.6.8.jar!/builtin/javasupport/core_ext/object.rb:129
       Pattern at file:/Users/user/Hbase/Hb126/lib/jruby-complete-1.6.8.jar!/builtin/java/java.util.regex.rb:2
        (root) at file:/Users/user/Hbase/Hb126/lib/jruby-complete-1.6.8.jar!/builtin/java/java.util.regex.rb:1
       require at org/jruby/RubyKernel.java:1062
        (root) at file:/Users/user/Hbase/Hb126/lib/jruby-complete-1.6.8.jar!/builtin/java/java.util.regex.rb:42
        (root) at /Users/user/Hbase/Hb126/bin/../bin/hirb.rb:38
```

- í•´ê²°
    - JDK ë²„ì „ì„ 8ë¡œ ë‹¤ìš´ í›„ ì¬ì‹œë„ í–ˆë”ë‹ˆ ì„±ê³µí•˜ì˜€ë‹¤.
        
        [Can't connect Hbase shell](https://stackoverflow.com/questions/48471168/cant-connect-hbase-shell)
        

### ë„ì»¤ ìš©ëŸ‰ ë¬¸ì œ

- í”„ë¡œì íŠ¸ ì§„í–‰ ë„ì¤‘ ë„ì»¤ê°€ ì‹¤í–‰ì´ ì•ˆë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

```docker
Error response from daemon: Cannot restart container 876cbda761eb: mkdir /var/lib/docker/overlay2/fcdb67d11c4602ef250e147e9c9cba056919580f66f553ff94488084f8ce5b59/merged: no space left on device
```

- ì‹œë„
    1. Dockerë¥¼ ì‚­ì œ í›„ ì¬ì„¤ì¹˜í•˜ë‹ˆ ì œëŒ€ë¡œ ë™ì‘í•˜ì˜€ë‹¤. 
    í•˜ì§€ë§Œ ë§¤ ë²ˆ ì¬ì„¤ì¹˜ë¥¼ í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë‹¤ë¥¸ í•´ê²°ì±…ì„ ì°¾ì•„ë³´ê¸°ë¡œí•˜ì˜€ë‹¤.
    2. EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ìš©ëŸ‰ì„ ëŠ˜ë ¤ ì²˜ë¦¬í•˜ì˜€ë‹¤. (Scale Up)
- í•´ê²°
    - Dockerì— ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ë“¤ì´ ê³„ì† ëˆ„ì ë˜ì–´ì„œ ë°œìƒí•˜ëŠ” í˜„ìƒì¸ ê²ƒìœ¼ë¡œ í™•ì¸í–ˆê³ , ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë¦¬ì†ŒìŠ¤ë“¤ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì‚­ì œí•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.
